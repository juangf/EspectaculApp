"use strict";!function(e,t){function i(e){this._title=e,this._element=null,this.setElement=function(e){return this._element=e,this},this.getElement=function(){return this._element},this.setTitle=function(e){return this._title=e,this},this.getTitle=function(){return this._title}}function n(e){this._events={},this._name=e,this._url="",this._transition="fade",this._templateUrl="",this._loaded=!1,this._element=null,this._header=null,this.addEventListener=function(e,t){var i=this._events,n=i[e]=i[e]||[];return n.push(t),!0},this.removeEventListener=function(e,t){for(var i=this._events[e],n=0,r=i.length;r>n;n++)if(i[n].toString()===t.toString())return view._events[e].splice(n,1),!0;return!1},this.raiseEvent=function(e,t){var i=this._events[e];if(i)for(var n=0,r=i.length;r>n;n++)i[n].apply(null,t);return!0},this.setHeader=function(e){return this._header=e,this},this.getHeader=function(){return this._header},this.setTransition=function(e){return this._transition=e,this},this.getTransition=function(){return this._transition},this.setTemplateUrl=function(e){return this._templateUrl=e,this},this.getTemplateUrl=function(){return this._templateUrl},this.setElement=function(e){return this._element=e,this},this.getElement=function(){return this._element},this.getName=function(){return this._name},this.setUrl=function(e){return this._url=e,this},this.getUrl=function(){return this._url},this.setIsLoaded=function(e){return this._loaded=e,this},this.isLoaded=function(){return this._loaded}}function r(e,t,i){app.trace(e,t,i)}e.app={_registerEvents:function(){var t=this;return e.onhashchange=function(){t._appNavigation(e.location.hash.substr(1))},this._registerTouchEvents(),this},_getViewByUrl:function(e){for(var t in this._views)if(this.getView(t).getUrl()===e)return this.getView(t);return null},_noTouch:function(e){var i=t.getElementsByTagName("body")[0];if(e){var n=t.createElement("disable-touch");i.appendChild(n)}else{var n=t.getElementsByTagName("disable-touch")[0];i.removeChild(n)}return this},_viewsTransition:function(e,t,i){var n=e.getElement(),r=t?t.getElement():null,s=e.getTransition()?e.getTransition():"fade";e.raiseEvent("beforeShow"),this.one(n,"webkitAnimationEnd animationEnd",function(){n.classList.remove(s),n.classList.remove("in"),e.raiseEvent("show"),i(e)}),n.className="current "+s+" in",e.getHeader()&&e.getHeader().getElement().classList.add("current"),r&&(t.raiseEvent("beforeHide"),this.one(r,"webkitAnimationEnd animationEnd",function(){r.className="",t.raiseEvent("hide")}),r.className="current "+s+" out",t.getHeader()&&t.getHeader().getElement().classList.remove("current"))},_appNavigation:function(e){var t=this;if(""===e)return this;if(!this._currentView||this._currentView.url!==e){var n=this._getViewByUrl(e);n?(this._noTouch(!0),n.isLoaded()?t._viewsTransition(n,t.getCurrentView(),function(e){t.setCurrentView(e)._noTouch(!1)}):this._loadTemplate(n,function(e,s){if(e){if(n.setElement(s).setIsLoaded(!0).raiseEvent("load"),t.getNavWrapper()){var a=s.getElementsByTagName("esp-content");if(a.length){a[0].classList.add("has-header");var o=n.getElement().getAttribute("view-title"),h=new i(o);h.setElement(t._appendHeader(o)),n.setHeader(h)}else r('Cannot find an "esp-content" tag".',"error")}t._viewsTransition(n,t.getCurrentView(),function(e){t.setCurrentView(e)._noTouch(!1)})}else r('Cannot load the view template "'+n.url+'".',"error")})):r('Cannot find the view "'+e+'".',"error")}return this},_injectDependencies:function(e){for(var i=["js/Page.js"],n=0,s=t.getElementsByTagName("body")[0],a=0;a<i.length;a++){var o=t.createElement("script");o.src=i[a],r('Injecting "'+o.src+'"',"info",1),e&&(o.onload=function(){++n===i.length&&e()}),s.appendChild(o)}return this},getViews:function(){return this._views},setViews:function(e){return this._views=e,this},setCurrentView:function(e){return this._currentView=e,this},getCurrentView:function(){return this._currentView},setFirstView:function(e){return this._firstView=e,this},getFirstView:function(){return this._firstView},setNavWrapper:function(e){return this._navWrapper=e,this},getNavWrapper:function(){return this._navWrapper},getView:function(e){return this._views.hasOwnProperty(e)?this._views[e]:(r('The view id "'+e+'" does not exist.',"error"),null)},goTo:function(e){return this._views.hasOwnProperty(e)?window.location="#"+e:r('The view id "'+e+'" does not exist.',"error"),this},_checkTagAttribute:function(e,t){return null!==e.getAttribute(t)?"true"===e.getAttribute(t)||""===e.getAttribute(t):!1},trace:function(e,t,i){if(i){for(var n="",r=0;i>r;r++)n+=" ";e=n+"└──> "+e}if(this._debug)switch(t){case"info":console.info(e);break;case"error":console.error(e);break;default:console.log(e)}return this},_appendView:function(e){var i=t.createElement("div");i.innerHTML=e;var n=i.getElementsByTagName("esp-view")[0];return this._viewWrapper.appendChild(n),n},_appendHeader:function(e){var i=t.createElement("esp-header");return i.innerHTML='<div class="title">'+e+"</div>",this.getNavWrapper().appendChild(i),i},_loadTemplate:function(e,i){var n=t.getElementById(e.getTemplateUrl()),s=this;if(n){var a=this._appendView(n.innerHTML);i&&i(!0,a)}else this.ajax({url:e.getTemplateUrl(),success:function(e){var t=s._appendView(e);i&&i(!0,t)},error:function(e,t){400==t?r("The view template does not exist.","error"):r("Cannot load view template.","error"),i&&i(!1)}});return this},_prepareViews:function(e){for(var t in e){var i=e[t],s=i.events,a=new n(t);if(!i.url)return r('The view "'+a.getName()+'" needs an url.',"error"),!1;if(a.setUrl(i.url),!i.templateUrl)return r('The view "'+a.getName()+'" needs a template url.',"error"),!1;a.setTemplateUrl(i.templateUrl),i.transition&&a.setTransition(i.transition),s&&(s.load&&this.on(a,"load",s.load),s.show&&this.on(a,"show",s.show),s.hide&&this.on(a,"hide",s.hide),s.beforeShow&&this.on(a,"beforeShow",s.beforeShow),s.beforeHide&&this.on(a,"beforeHide",s.beforeHide)),this._views[t]=a}},config:function(e){e.debugMode&&(this._debug=e.debugMode),r("Configure EspectaculApp.","info"),this._registerEvents(),this._viewWrapper=t.getElementsByTagName("esp-view-wrapper")[0];var i=t.getElementsByTagName("esp-nav-wrapper");i.length&&this.setNavWrapper(i[0]),e.views?(this._prepareViews(e.views),e.firstView&&(this.getViews().hasOwnProperty(e.firstView)?this.setFirstView(this.getView([e.firstView])):r('The first view "'+e.firstView+'" does not exist.',"error"))):r("views values fault.","error")},init:function(){if(r("Init EspectaculApp.","info"),this._debug&&(e.location.hash=""),!this.getFirstView()){var t=Object.keys(this.getViews());this.setFirstView(this.getView([t[0]]))}if(this._debug){var i=this;setTimeout(function(){e.location="#"+i.getFirstView().getUrl()},0)}else e.location="#"+this.getFirstView().getUrl()}},e.app.ajax=function(e){var t=new XMLHttpRequest;return t.onreadystatechange=function(){4==t.readyState&&(200==t.status?e.success(t.responseText):e.error(t,t.status,"error"))},t.open(e.method?e.method:"GET",e.url,e.asynch?e.asynch:!0),t.send(),this},e.app.on=function(e,t,i){for(var n=t.split(" "),r=0;r<n.length;r++)e.addEventListener(n[r],i,!1)},e.app.off=function(e,t,i){for(var n=t.split(" "),r=0;r<n.length;r++)e.removeEventListener(n[r],i)},e.app.one=function(e,t,i){var n=this,r=function(s){n.off(e,t,r),i(s)};this.on(e,t,r)},e.app._touches={},e.app._drawTouches=!1,e.app._registerTouchEvents=function(){function i(){for(var e="0123456789ABCDEF".split(""),t="#",i=0;6>i;i++)t+=e[Math.floor(16*Math.random())];return t}var n=this,r=function(e){for(var i=0;i<e.changedTouches.length;i++){var r=e.changedTouches[i];if(n._drawTouches){var s=t.getElementsByTagName("body")[0];s.removeChild(t.getElementById("esp-finger-"+r.identifier))}delete n._touches[r.identifier]}};e.ontouchstart=function(e){for(var r=0;r<e.changedTouches.length;r++){var s=e.changedTouches[r];if(n._drawTouches){var a=t.createElement("esp-finger"),o=t.getElementsByTagName("body")[0];a.setAttribute("id","esp-finger-"+s.identifier),s.color=i(),a.style.cssText="-webkit-transform: translate3d("+s.clientX+"px,"+s.clientY+"px,0px); background-color:"+s.color,o.appendChild(a)}n._touches[s.identifier]=s}},e.ontouchmove=function(e){for(var i=0;i<e.changedTouches.length;i++){var r=n._touches[e.changedTouches[i].identifier].color,s=e.changedTouches[i];if(s.color=r,n._drawTouches){var a=t.getElementById("esp-finger-"+s.identifier);a.style.cssText="-webkit-transform: translate3d("+s.clientX+"px,"+s.clientY+"px,0px); background-color:"+r}n._touches[s.identifier]=s}},e.ontouchend=e.ontouchleave=e.ontouchcancel=r},e.app.getTouches=function(){return this._touches},e.app.drawTouches=function(e){this._drawTouches=e?!0:!1},e.app._debug=!1,e.app._navWrapper=null,e.app._viewWrapper=null,e.app._views={},e.app._currentView=null,e.app._firstView=null,e.app._inTransition=!1}(window,document);